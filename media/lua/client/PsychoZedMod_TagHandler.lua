--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]



PsychoZedMod = PsychoZedMod or {}

function PsychoZedMod.isShowTag()
    return SandboxVars.PsychoZed.ShowName or getCore():getDebug()
end

function PsychoZedMod.isTagEmpty(targ)
    return tostring(targ:getChildSprites())  == '[]'
end
function PsychoZedMod.isHasTag(targ)
    return not PsychoZedMod.isTagEmpty(targ)
end

function PsychoZedMod.isPsychoChar(targ)
    if (instanceof(targ, "IsoPlayer") and PsychoZedMod.isWearingPsychoZed(targ)) then
        return true
    elseif (instanceof(targ, "IsoZombie") and PsychoZedMod.isPsychoZed(targ)) then
        return true
    else
        return false
    end
end

function PsychoZedMod.removeTag(targ)
    targ:clearAttachedAnimSprite()
end
--[[
function PsychoZedMod.removeTag(targ)
    --if not PsychoZedMod.isHasTag(zed) then return end
    if PsychoZedMod.isPsychoChar(targ) then
       local anims = targ:getAttachedAnimSprite()
        for i = 1, anims:size() do
            local spr = anims:get(i-1)
            --if getCore():getDebug() then print(spr) end
            anims:remove(spr)
        end
        if PsychoZedMod.isHasTag(targ) then
            targ:clearAttachedAnimSprite()
        end
        if getCore():getDebug() and dbgZed == targ then
            print('removeTag')
        end
    end
end
 ]]
--[[

function PsychoZedMod.refreshTag(zed, int)
    if zed and PsychoZedMod.isPsychoZed(zed) then
        if PsychoZedMod.isHasTag(zed) then PsychoZedMod.removeTag(zed) end
        if int then
            PsychoZedMod.setTag(zed, int)
        else
            PsychoZedMod.setTag(zed)
        end

    end
end ]]


function PsychoZedMod.setTag(targ, int)
    if PsychoZedMod.isShowTag() then
        if targ then
            if PsychoZedMod.isPsychoZed(targ) or PsychoZedMod.isWearingPsychoZed(targ) then
                if int == nil then
                    int = PsychoZedMod.getDayTimeInt()
                end
                if getCore():getDebug() and dbgZed == targ then
                    print('setTag int: '..tostring(int))
                end
                --targ:getAttachedAnimSprite():add(getSprite("media/ui/Tags/Psycho"..tostring(PsychoZedMod.getDayTimeInt())..".png"):newInstance())
                if PsychoZedMod.isHasTag(targ) then
                    targ:clearAttachedAnimSprite()
                end
                local spr = getSprite("media/ui/Tags/Psycho"..tostring(int)..".png"):newInstance()
                targ:setAttachedAnimSprite(ArrayList.new())
                local anm = targ:getAttachedAnimSprite():add(spr)
            end
        end
    end
end

function PsychoZedMod.setStatsToAll()
    local zombies = getCell():getZombieList()
    if not getCell() or not zombies then return end
    for i = 0, zombies:size() - 1 do
        local zed = zombies:get(i)
        if zed and PsychoZedMod.isPsychoZed(zed) then
			local num = PsychoZedMod.getDayTimeInt()
            PsychoZedMod.setTag(zed, num)
            if zed:getModData()['PsychoZed_Init'] ~= nil then
				PsychoZedMod.setStats(zed)
            end
        end
    end
end

function PsychoZedMod.dayShift(timeOfDay)
    if timeOfDay == "Day" then
		if getCore():getDebug() then
			print("PsychoZedMod: It's now daytime!")
		end
		PsychoZedMod.setStatsToAll()
    elseif timeOfDay == "Night" then

		if getCore():getDebug() then
			print("PsychoZedMod: It's now nighttime!")
		end
		PsychoZedMod.setStatsToAll()
    end
end

--Events.OnDayTimeChange.Add(PsychoZedMod.dayShift)
--Events.EveryTenMinutes.Add(PsychoZedMod.checkDayTimeChange)


function PsychoZedMod.checkDayTimeChange()
    if not PsychoZedMod.lastDayTime then
        PsychoZedMod.lastDayTime = PsychoZedMod.getDayTime()
    end

    local currentDayTime = PsychoZedMod.getDayTime()

    if currentDayTime ~= PsychoZedMod.lastDayTime then
        triggerEvent("OnDayTimeChange", currentDayTime)
        PsychoZedMod.lastDayTime = currentDayTime
    end
end

--[[
print(PsychoZedMod.isHasTag(zed))
local int = 2
local spr = getSprite("media/ui/Tags/Psycho"..tostring(int)..".png"):newInstance()
zed:setAttachedAnimSprite(ArrayList.new())
local anm = zed:getAttachedAnimSprite():add(spr)

PsychoZedMod.setTag(zed, 1)
PsychoZedMod.setTag(zed, 2)
PsychoZedMod.setTag(zed, 1)
PsychoZedMod.setTag(zed, 2)
PsychoZedMod.removeTag(zed)
PsychoZedMod.setTag(zed, PsychoZedMod.getDayTimeInt())
print(PsychoZedMod.getDayTimeInt())

 ]]