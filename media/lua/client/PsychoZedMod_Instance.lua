--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]












--[[


updates:
FIXED normal zed using psycho anim bug
Tweaked movement speed for both modes
admins wearing psycho skin will auto change textures
added crying idle animation
added crying walking animation




 ]]












-- disabled this lua
-- i suspect this is the reason for the fps drop problem

--[[
function PsychoZedMod.getCol(int)
    local defaultColor = { r=1, g=1, b=1 }
    if not int then return defaultColor end

    local colors = {

        [1] = { r=1, g=0, b=0 },     -- Red
        [2] = { r=1, g=0.5, b=0 },   -- Orange
        [3] = { r=1, g=1, b=0 },     -- Yellow
        [4] = { r=0, g=1, b=0 },     -- Green
        [5] = { r=0, g=0, b=1 },     -- Blue
        [6] = { r=0.29, g=0, b=0.51 }, -- Indigo
        [7] = { r=0.56, g=0, b=1 },  -- Violet
        [8] = { r=1, g=1, b=1 },      -- White
        [9] = { r=0, g=0, b=0 },     -- Black
    }

    return colors[int] or defaultColor
end


PsychoZedMod.Instance = {}
PsychoZedMod.Instance.__index = PsychoZedMod.Instance
PsychoZedMod.filter = {} ]]

--[[

    function PsychoZedMod.Instance:setTagColors(tag)
        local int = SandboxVars.PsychoZed.Color or ZombRand(1, 10)
        if int then
            local col = PsychoZedMod.getCol(int)
            tag:setDefaultColors(col.r, col.g, col.b)
        else
            local mpc = getCore():getMpTextColor()
            tag:setDefaultColors(mpc:getR(), mpc:getG(), mpc:getB())
        end
        tag:setVisibleRadius(180)
    end

    function PsychoZedMod.Instance:calculateTagPosition(zed)
        local zoom = getCore():getZoom(0)
        local x, y, z = zed:getX(), zed:getY(), zed:getZ()
        local tagX = (IsoUtils.XToScreen(x, y, z, 0) - IsoCamera.getOffX() - zed:getOffsetX()) / zoom
        local tagY = (IsoUtils.YToScreen(x, y, z, 0) - IsoCamera.getOffY() - zed:getOffsetY() - 130) / zoom
        return tagX, tagY
    end



    function PsychoZedMod.Instance:Handler(zed, tag, pl)
        if not zed or not tag or not pl then return end



        local function onTick(ticks)
            if not zed or not PsychoZedMod.isPsychoZed(zed) or zed:isDead() then
                PsychoZedMod.filter[zed:getOnlineID()] = nil
                Events.OnTick.Remove(onTick)
                return
            end


            self:setTagColors(tag)
            local tagX, tagY = self:calculateTagPosition(zed)
            local dist = PsychoZedMod.checkDist(pl, zed)

            if not zed or not PsychoZedMod.isPsychoZed(zed) or zed:isDead() then return end -- this is to prevent the issue that the tag is still left on the ground
            local msg = tostring(zed:getOutfitName())


            local zedSq = zed:getSquare()
            if zedSq then
                if zedSq:isCouldSee(pl:getPlayerNum()) and dist <= 50 then
                    tag:ReadString(UIFont.Small, tostring(msg), -1)
                    tag:AddBatchedDraw(tagX, tagY, true, 1)
                end
            end
        end


        Events.OnTick.Add(onTick)
        PsychoZedMod.filter[zed:getOnlineID()] = onTick
    end




    function PsychoZedMod.Instance:filter(zed)
        local pl = getPlayer()
        if not pl then return end
        if not PsychoZedMod.filter[zed:getOnlineID()] then
            if PsychoZedMod.isPsychoZed(zed) then
                PsychoZedMod.setStats(zed)
                if getCore():getDebug() or SandboxVars.PsychoZed.ShowName == true then
                    local tag = TextDrawObject.new()
                    self:Handler(zed, tag, pl)
                end
            end
        end
    end


    function PsychoZedMod.Instance:Collector()
        local zombies = getCell():getZombieList()
        if not getCell() or not zombies then return end
        for i = 0, zombies:size() - 1 do
            local zed = zombies:get(i)
            if zed and PsychoZedMod.isPsychoZed(zed) then
                self:filter(zed)
            end
        end
    end

    Events.OnZombieUpdate.Add(function() PsychoZedMod.Instance:Collector() end)

    setmetatable(PsychoZedMod.Instance, PsychoZedMod.Instance)

end ]]

-----------------------            ---------------------------

