--[[██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                        				 Custom  PZ  Mod  Developer  for  Hire													  |
|‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾|
|                       	Portfolio:  https://steamcommunity.com/id/glytch3r/myworkshopfiles/							          |
|                       		                                    														 	  |
|                       	Discord:    Glytch3r#1337 / glytch3r															      |
|                       		                                    														 	  |
|                       	Support:    https://ko-fi.com/glytch3r														    	  |
|_______________________________________________________________________________________________________________________________-]]
--[[_____________________________________________________________________________________________________________________________
   ░▒▓██████▓▒░    ░▒▓████████▓▒░    ░▒▓█▓▒░         ░▒▓█▓▒░      ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░           ░▒▓█▓▒░         ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▓▒░  ░▒▓▒░
  ░▒▓█▓▒▒▓███▓▒░   ░▒▓█▓▒░         ░▒▓██████▓▒░      ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█████████▓▒░     ░▒▓███▓▒░     ░▒▓███████▓▒░
  ░▒▓█▓▒░          ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░         ░▒▓█▓▒░ ░▒▓█▓▒░         ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
  ░▒▓█▓▒░░▒▓█▓▒░   ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░     ░▒▓█▓▒░     ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓█▓▒░ ░▒▓█▓▒░  ▒▓░    ░▒▓█▓▒░   ░▒▓█▒░  ░▒▓█▒░
   ░▒▓█████▓▒░     ░▒▓█▓▒░        ░▒▓█▓▒░░▒▓█▓▒░  ░▒▓███████▓▒░   ░▒▓██████▓▒░   ░▒▓█▓▒░ ░▒▓█▓▒░  ░▒▓███████▓▒░    ░▒▓███████▓▒░
█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████--]]


-----------------------            ---------------------------
--[[
	PsychoZedMod.playSFX(zed, PsychoZedMod.getCrySfx())
	PsychoZedMod.playSFX(zed, PsychoZedMod.getLaughSfx())
	PsychoZedMod.playSFX(zed, PsychoZedMod.getScreamSfx())
 ]]
-----------------------            ---------------------------


PsychoZedMod = PsychoZedMod or {}


function PsychoZedMod.setStats(zed)
    if zed and PsychoZedMod.isPsychoZed(zed) then
        if zed:getModData()['PsychoZed_Init'] == nil then
            local sandOpt = getSandboxOptions()
            local zCog = sandOpt:getOptionByName("ZombieLore.Cognition"):getValue()
            local zTough = sandOpt:getOptionByName("ZombieLore.Toughness"):getValue()
            local zStr = sandOpt:getOptionByName("ZombieLore.Strength"):getValue()

            local zMem = sandOpt:getOptionByName("ZombieLore.Memory"):getValue()
            local zSee = sandOpt:getOptionByName("ZombieLore.Sight"):getValue()
            local zHear = sandOpt:getOptionByName("ZombieLore.Hearing"):getValue()


            sandOpt:set("ZombieLore.Cognition",1) -- 1 navigate + doors
            sandOpt:set("ZombieLore.Toughness",1) 	-- 1 tough
            sandOpt:set("ZombieLore.Strength",1) -- 1 superhuman

            sandOpt:set("ZombieLore.Memory",4) --none
            sandOpt:set("ZombieLore.Sight",3) -- poor
            sandOpt:set("ZombieLore.Hearing",2) -- normal
            -----------------------            ---------------------------
			local tSpeed =  SandboxVars.PsychoZed.TurnSpeed or 1.5
			PsychoZedMod.setTurnSpeed(zed, tSpeed)
            -----------------------            ---------------------------

            zed:getModData()['PsychoZed_Init'] = true
            zed:setVariable('isPsychoZed', 'true')
            -----------------------            ---------------------------

			if not PsychoZedMod.isHasTag(zed) then
				PsychoZedMod.setTag(zed)
			end

            zed:makeInactive(true);
            zed:makeInactive(false);
            zed:DoZombieStats()

            sandOpt:set("ZombieLore.Cognition", zCog)
            sandOpt:set("ZombieLore.Toughness", zTough)
            sandOpt:set("ZombieLore.Strength", zStr)

            sandOpt:set("ZombieLore.Memory", zMem)
            sandOpt:set("ZombieLore.Sight", zSee)
            sandOpt:set("ZombieLore.Hearing", zHear)
            --getSandboxOptions():toLua()


        end
    end
end
--the player thinks that the zed is a real human so they dont want to harm it, just dont know what to name it
function PsychoZedMod.setSympathy(zed, bool)
	if not PsychoZedMod.isPsychoZed(zed) then return end
	if bool == false then
		if not zed:isShootable() then
			zed:setShootable(true)
		end
		if zed:avoidDamage() then
			zed:setAvoidDamage(false)
		end
	else
		if not PsychoZedMod.isSympathy(zed) then
			if not zed:avoidDamage() then
				zed:setAvoidDamage(true)
			end
			if zed:isShootable() then
				zed:setShootable(false)
			end
		end
	end
end
function PsychoZedMod.shouldSympathize(zed)
	if PsychoZedMod.isCrying(zed) and  PsychoZedMod.isDay() then
		return SandboxVars.PsychoZed.PlayerSympathy
	end
	return false
end

function PsychoZedMod.isSympathy(zed)
	if zed:avoidDamage() and not zed:isShootable() then
		return true
	end
	return false
end


-- SandboxVars.PsychoZed.PlayerSympathy if this is true then psycho shouldnt stop crying and just ignore player
-- it shouldnt get hurt when its attacked
-- but if SandboxVars.PsychoZed.PlayerSympathy is set to false then it should go agro when a player attacks it
function PsychoZedMod.NightHandler(zed)
    if not zed then  return end
	if	not PsychoZedMod.isPsychoZed(zed)  then return end
	if PsychoZedMod.isDay() then return end

    if PsychoZedMod.isNight() then
		if PsychoZedMod.isAggro(zed) then
			if PsychoZedMod.isCrying(zed) then
				PsychoZedMod.setCry(zed, false)
			end
		end
		if PsychoZedMod.isSympathy(zed) then
			PsychoZedMod.setSympathy(zed, false)
		end

        local tSpeed = SandboxVars.PsychoZed.TurnSpeed or 1.5
        PsychoZedMod.setTurnSpeed(zed, tSpeed)
		if PsychoZedMod.isShouldStand(zed) then
			PsychoZedMod.setStand(zed)
			zed:setCanWalk(true)
			zed:setAvoidDamage(false)
		end
    end
end


Events.OnZombieUpdate.Remove(PsychoZedMod.NightHandler)
--Events.OnZombieUpdate.Add(PsychoZedMod.NightHandler)

-----------------------  day*          ---------------------------

function PsychoZedMod.DayHandler(zed)
    if not PsychoZedMod.isPsychoZed(zed) then return end
    local pl = getPlayer()
    if not pl then return end
    if PsychoZedMod.isNight() then return end

    if PsychoZedMod.isDay() then
        PsychoZedMod.setTurnSpeed(zed, 1)

        if PsychoZedMod.isAggro(zed) then
            if PsychoZedMod.isShouldIgnore(zed) then
                PsychoZedMod.setIgnore(zed)
            end
			if PsychoZedMod.isCrying(zed) then
				PsychoZedMod.setCry(zed, false)
			end
        else

			local zsq = zed:getSquare()
			if zsq then
				if not zsq:isOutside() then
					if not PsychoZedMod.isCrying(zed) then
						PsychoZedMod.setCry(zed, true)
					end
				end
			end

            if PsychoZedMod.isCrying(zed) then
                if not PsychoZedMod.isSympathy(zed) then
                    PsychoZedMod.setSympathy(zed, true)
                end
            else
				if PsychoZedMod.isSympathy(zed) then
                    PsychoZedMod.setSympathy(zed, false)
                end
            end

        end

		if PsychoZedMod.shouldSympathize(zed) then
			if (pl:IsAiming() or pl:isAimKeyDown()) and PsychoZedMod.isTarg(pl, zed) then
				if PsychoZedMod.isCrying(zed) then
					if not PsychoZedMod.isSympathy(zed) then
						PsychoZedMod.setSympathy(zed, true)
					end
					pl:nullifyAiming()
					pl:setIgnoreAimingInput(true)
				else
					if PsychoZedMod.isSympathy(zed) then
						PsychoZedMod.setSympathy(zed, false)
					end
					pl:setIgnoreAimingInput(false)
				end
			else
				if PsychoZedMod.isSympathy(zed) then
					PsychoZedMod.setSympathy(zed, false)
				end
				pl:setIgnoreAimingInput(false)
			end
		end
    end
end

Events.OnZombieUpdate.Remove(PsychoZedMod.DayHandler)
--Events.OnZombieUpdate.Add(PsychoZedMod.DayHandler)
-----------------------            ---------------------------

function PsychoZedMod.isCrying(zed)
	return zed:isForceEatingAnimation()
end

function PsychoZedMod.setCry(zed, bool)
	if bool == true then
		zed:setForceEatingAnimation(true)
		if zed:isCanWalk() then
			zed:setCanWalk(false)
		end
	elseif bool == false then
		if PsychoZedMod.isShouldStand(zed) then
			PsychoZedMod.setStand(zed)
			zed:setCanWalk(true)
			zed:setAvoidDamage(false)
		end
	end
end


function PsychoZedMod.isShouldStand(zed)
	if not zed:isBeingSteppedOn() then
		if zed:isCanWalk() then return true end
		if zed:isFakeDead() then return true end
		if zed:isForceEatingAnimation() then return true end
		if zed:isOnFloor() then return true end
		if zed:isCrawling() then return true end
		if zed:isUseless() then return true end
		if zed:isSitAgainstWall() then return true end
	end
    return false
end

function PsychoZedMod.setStand(zed)
    if not zed:isCanWalk() then
        zed:setCanWalk(true)
    end
    if zed:isFakeDead() or zed:isCurrentState(FakeDeadZombieState.instance())  then
        zed:setFakeDead(false)
    end
    if zed:isForceEatingAnimation() then
        zed:setForceEatingAnimation(false)
    end
    if zed:isSitAgainstWall() then
        zed:setSitAgainstWall(false)
    end
    if zed:isCrawling() then
        zed:toggleCrawling()
		zed:setCrawler(false)
    end
	if zed:isOnFloor() then
		zed:changeState(ZombieGetUpState.instance())
	end
	if zed:isUseless() then
		zed:setUseless(false)
	end
	zed:setOnFloor(false);
end

function PsychoZedMod.isAggro(zed)
	local targ = zed:getTarget()
	if not targ then return false end
	return instanceof(targ, "IsoPlayer")
end

function PsychoZedMod.isMoving(zed)
	if not SandboxVars.PsychoZed.IgnorePlayer then return false end
	return zed:getCurrentState() == WalkTowardState.instance() --or zed:isCurrentState(WalkTowardNetworkState.instance()) or zed:isCurrentState(PathFindState.instance())
end

function PsychoZedMod.isShouldIgnore(zed)
	if not SandboxVars.PsychoZed.IgnorePlayer then return false end
	if PsychoZedMod.isNight() then return false end
	if PsychoZedMod.isMoving(zed) then return false end
	if zed:isZombieAttacking() or zed:isAttacking() then return false end

	return true
end



function PsychoZedMod.setIgnore(zed)
	if PsychoZedMod.isNight() then return end
	if PsychoZedMod.isAggro(zed) then
--[[ 		zed:clearAggroList()
		zed:setTarget(nil) ]]
	end
end



function PsychoZedMod.isLaughing(zed)
	return PsychoZedMod.isAggro(zed) and not PsychoZedMod.isCrying(zed)
end


-----------------------            ---------------------------


function PsychoZedMod.getState(zed)
    return zed:getCurrentState()
end


-----------------------            ---------------------------



--if zed:isCurrentState(AttackNetworkState.instance()) or zed:isCurrentState(AttackNetworkState.instance()) then end
--PsychoZedMod.isWithinRange(pl, zed, range) and PsychoZedMod.isClosestPl(pl, zed)


--[[ 	if (pl:IsAiming() or pl:isAimKeyDown()) and PsychoZedMod.isTarg(pl, zed) then
		if PsychoZedMod.isCrying(zed) then
			if SandboxVars.PsychoZed.PlayerSympathy then
				if not PsychoZedMod.isSympathy(zed) then
					PsychoZedMod.setSympathy(zed, true)
				end
				pl:nullifyAiming()
				pl:setIgnoreAimingInput(true)
			end
		else
			if PsychoZedMod.isSympathy(zed) then
				PsychoZedMod.setSympathy(zed, false)
			end
			pl:setIgnoreAimingInput(false)
		end
	else
		if PsychoZedMod.isSympathy(zed) then
			PsychoZedMod.setSympathy(zed, false)
		end
		pl:setIgnoreAimingInput(false)
	end
 ]]
-----------------------            ---------------------------
